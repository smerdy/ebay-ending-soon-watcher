"use strict";var ebay=require("ebay-api"),fs=require("fs"),moment=require("moment"),ebayConfig=JSON.parse(fs.readFileSync("src/config.json")).ebay;module.exports=function(e,i,n){var r={keywords:e.query.split(" "),paginationInput:{entriesPerPage:10},itemFilter:[{name:"MaxPrice",value:"900"},{name:"MinPrice",value:"350"}],sortOrder:"EndingTimeSoonest"};ebay.xmlRequest({serviceName:"Finding",opType:"findItemsByKeywords",devId:ebayConfig.devId,certId:ebayConfig.certId,appId:ebayConfig.appId,authToken:ebayConfig.authToken,params:r,parser:ebay.parseResponseJson},function(e,r){if(e)throw e;var a=r.searchResult.item;console.log("Found",a.length,"items.");var t=a.map(function(e){var n=moment.duration(e.sellingStatus.timeLeft);return!(n.asMilliseconds()>36e5*i)&&{title:e.title,price:e.sellingStatus.currentPrice.amount,hoursLeft:n.asHours(),picURL:e.galleryURL,url:e.viewItemURL}}).filter(Boolean);console.log("Emailing",t.length),n(t)})};
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var _mailer=require("./../src/mailer"),_mailer2=_interopRequireDefault(_mailer),_ebayFetch=require("./../src/ebayFetch"),_ebayFetch2=_interopRequireDefault(_ebayFetch),CronJob=require("cron").CronJob,hour_gap=8,ebayOptions={query:"fujifilm x-t1 lens",price_low:400,price_high:610},job=new CronJob("00 00 0-23/"+String(hour_gap)+" * * *",function(){(0,_ebayFetch2["default"])(ebayOptions,hour_gap,function(e){if(e.length>0){var r={ebayItems:e,subject:ebayOptions.query};(0,_mailer2["default"])(r)}})},function(){},(!0),"America/Los_Angeles",(void 0),(!0));
"use strict";var fs=require("fs"),nodemailer=require("nodemailer"),config=JSON.parse(fs.readFileSync("src/config.json")),Email=require("email-templates");module.exports=function(e){var s=nodemailer.createTransport({service:"gmail",secure:!1,port:25,auth:{user:config.email,pass:config.password},tls:{rejectUnauthorized:!1}}),a=new Email({message:{from:"joshua.pham@gmail.com"},send:!0,preview:!1,juice:!1,htmlToText:!1,transport:s});a.send({template:"endingSoonNotification",message:{to:"joshua.pham@gmail.com"},locals:{ebayItems:e.ebayItems,subject:e.subject}}).then(console.log)["catch"](console.error)};