"use strict";var NUM_HOURS=12,TODAY=new Date,restify=require("restify"),trim=require("trim"),request=require("request"),cheerio=require("cheerio"),server=restify.createServer({name:"ebay-ending-watcher",version:"1.0.0"});server.use(restify.acceptParser(server.acceptable)),server.use(restify.queryParser()),server.use(restify.bodyParser()),server.get("/ebay-ending-soon/:name",function(e,r,t){var i=e.params.LH_Complete||0,s=e.params.LH_Sold||0,a=e.params.LH_BIN||0,n="http://www.ebay.com/sch/i.html?_from=R40&_sacat=0&_nkw="+e.params.name+"&_sop=1&_udlo="+e.params.price_low+"&_udhi="+e.params.price_high+"&LH_Complete="+i+"&LH_Sold="+s+"&LH_BIN="+a+"&LH_ItemCondition=1000|1500|3000&_ipg=200&rt=nc";return console.log(n),request(n,function(e,t,i){if(200===t.statusCode){var s=cheerio.load(i),a=Array.from(s(".sresult")).filter(function(e){var r=parseInt(s(e).find(".timeleft .timeMs").attr("timems"));if(r){var t=new Date;if(t.setTime(r),t-TODAY<=36e5*NUM_HOURS)return!0}return!1}).map(function(e){var r=new Date;return r.setTime(parseInt(s(e).find(".timeleft .timeMs").attr("timems"))),{title:trim(s(e).find("h3.lvtitle").text()),price:parseFloat(trim(s(e).find(".lvprice").text()).replace(",","").replace("$","")),endsAt:r.toString(),itemListingUrl:s(e).find(".lvtitle a").attr("href"),itemPictureUrl:s(e).find(".lvpic img").attr("src")}});r.send(a)}}),t()});var port=process.env.PORT||5e3;server.listen(port,function(){console.log("%s listening at %s",server.name,server.url)});