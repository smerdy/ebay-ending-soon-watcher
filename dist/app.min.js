"use strict";function convertMS(e){var t,r,i,n;return n=Math.floor(e/1e3),i=Math.floor(n/60),n%=60,r=Math.floor(i/60),i%=60,t=Math.floor(r/24),r%=24,{d:t,h:r,m:i,s:n}}var trim=require("trim"),request=require("request"),cheerio=require("cheerio"),TODAY=new Date;module.exports=function(e,t,r){var i="http://www.ebay.com/sch/i.html?_from=R40&_sacat=0&_nkw="+e.name+"&_sop=1&_udlo="+e.price_low+"&_udhi="+e.price_high+"&LH_ItemCondition=1000|1500|3000&_ipg=200&rt=nc";console.log(i),request(i,function(e,i,n){if(200===i.statusCode){var a=cheerio.load(n),o=Array.from(a(".sresult")).filter(function(e){var r=parseInt(a(e).find(".timeleft .timeMs").attr("timems"));if(r){var i=new Date;if(i.setTime(r),i-TODAY<=36e5*t)return!0}return!1}).map(function(e){var t=new Date;t.setTime(parseInt(a(e).find(".timeleft .timeMs").attr("timems")));var r=convertMS(t-TODAY),i=r.h+"h "+r.m+"m";return{title:trim(a(e).find("h3.lvtitle").text()),price:parseFloat(trim(a(e).find(".lvprice").text()).replace(",","").replace("$","")),endsAt:i,itemListingUrl:a(e).find(".lvtitle a").attr("href"),itemPictureUrl:a(e).find(".lvpic img").attr("src")}});r(o)}})};
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var _mailer=require("./../src/mailer"),_mailer2=_interopRequireDefault(_mailer),_ebayFetch=require("./../src/ebayFetch"),_ebayFetch2=_interopRequireDefault(_ebayFetch),CronJob=require("cron").CronJob,hour_gap=6,ebayOptions={name:"fujifilm+x-t1",price_low:300,price_high:400},job=new CronJob("00 0-59/1 * * * *",function(){(0,_ebayFetch2["default"])(ebayOptions,hour_gap,function(e){if(e.length>0){var r=e.map(function(e){return'<a href="'+e.itemListingUrl+'">'+e.title+'</a><img src="'+e.itemPictureUrl+'"><p>'+e.price+"</p><p>"+e.endsAt+"</p>"}).join("<br>"),i={htmlBody:r,subject:ebayOptions.name};(0,_mailer2["default"])(i)}else{var i={htmlBody:"No items found!",subject:ebayOptions.name};(0,_mailer2["default"])(i)}})},function(){},(!0),"America/Los_Angeles");
"use strict";var fs=require("fs"),nodemailer=require("nodemailer"),config=JSON.parse(fs.readFileSync("src/config.json"));module.exports=function(e){var r=nodemailer.createTransport({service:"gmail",secure:!1,port:25,auth:{user:config.email,pass:config.password},tls:{rejectUnauthorized:!1}}),o={from:config.email,to:config.email,subject:e.subject,html:e.htmlBody};r.sendMail(o,function(e,r){e&&console.log("Error occurred. "+e),console.log("Message sent: %s",r)})};